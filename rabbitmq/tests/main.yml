---
- name: test rabbitmq.conf template expansion
  hosts: localhost
  gather_facts: false
  tasks:
    - name: verify expands correctly with default variables
      debug:
        msg: TODO implement

    - name: verify expands correctly with custom variables
      debug:
        msg: TODO implement


- name: test set up RabbitMQ broker
  hosts: rabbitmq
  become: true
  tasks:
    - name: retrieve facts about distro packages
      package_facts:

    - name: verify correct packages installed
      assert:
        that:
          - "'epel-release' in ansible_facts.packages"
          - >
            'rabbitmq-server' in ansible_facts.packages and
            ansible_facts.packages['rabbitmq-server'] | length == 1 and
            ansible_facts.packages['rabbitmq-server'][0].version is version_compare('3.8.14', '>=')

    - debug:
        msg: TODO verify erlang-erts isn't installed

    - debug:
        msg: TODO verify erlang version 23.2.7 or newer is installed

    - name: test place rabbitmq config file
      debug:
        msg: TODO implement
